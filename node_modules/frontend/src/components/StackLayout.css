/* StackLayout - Dynamic Stack Layout Component */

.stack-layout {
  position: relative;
  width: 100%;
  min-height: 800px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 40px 20px;
  
  /* Cross-browser isolation for performance */
  isolation: isolate;
  -webkit-isolation: isolate;
}

.stack-layout__container {
  position: relative;
  width: 500px;
  height: 700px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: radial-gradient(ellipse at center, 
    rgba(138, 43, 226, 0.05) 0%,
    rgba(30, 144, 255, 0.03) 25%,
    rgba(0, 255, 127, 0.02) 50%,
    rgba(255, 20, 147, 0.03) 75%,
    rgba(255, 165, 0, 0.05) 100%
  );
  border-radius: 24px;
  overflow: visible;
}

/* Enhanced window wrapper with 3D depth effects */
.stack-layout__window-wrapper {
  position: absolute;
  transform-origin: center center;
  cursor: pointer;
  transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
  
  /* Enhanced 3D performance optimizations */
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;
  transform-style: preserve-3d;
  -webkit-transform-style: preserve-3d;
  contain: layout style paint;
  
  /* Add depth shadows for stacking effect */
  filter: drop-shadow(0 5px 15px rgba(0, 0, 0, 0.1));
  -webkit-filter: drop-shadow(0 5px 15px rgba(0, 0, 0, 0.1));
}

/* Enhanced animation states */
.stack-layout--animating .stack-layout__window-wrapper {
  /* During animation, use performance-optimized properties */
  will-change: transform, opacity, z-index;
  
  /* Force hardware acceleration during animations */
  transform: translateZ(0);
  -webkit-transform: translateZ(0);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

.stack-layout__window-wrapper--transitioning {
  /* Special easing for smooth transitions */
  transition-timing-function: cubic-bezier(0.25, 0.46, 0.45, 0.94) !important;
}

/* Animation performance optimizations */
.stack-layout--animating .stack-layout__window-wrapper--active {
  /* Active window gets priority animation treatment */
  transition-duration: 0.35s !important;
  transition-delay: 0ms !important;
}

.stack-layout--animating .stack-layout__window-wrapper--inactive {
  /* Inactive windows use staggered timing */
  transition-duration: 0.4s !important;
}

/* Active window positioning (centered, full size) */
.stack-layout__window-wrapper--active {
  left: 50% !important;
  top: 50% !important;
  transform: translate(-50%, -50%) scale(1) !important;
  z-index: 1000 !important;
  opacity: 1 !important;
}

/* Inactive window positioning */
.stack-layout__window-wrapper--inactive {
  transform-origin: center center;
  left: 50%;
  top: 50%;
}

/* Enhanced WindowCard modifications for artistic stack layout */
.stack-layout .window-card--stack-active {
  /* Enhanced styling for active window in stack with colorful glow */
  box-shadow: 
    0 30px 80px rgba(138, 43, 226, 0.3),
    0 20px 60px rgba(30, 144, 255, 0.25),
    0 15px 40px rgba(0, 255, 127, 0.2),
    0 10px 25px rgba(255, 20, 147, 0.18),
    inset 0 2px 0 rgba(255, 255, 255, 0.6);
  border-width: 3px;
  transform: perspective(1000px) rotateX(5deg) rotateY(-2deg);
}

.stack-layout .window-card--stack-inactive {
  /* Subtle styling for inactive windows in stack */
  background: rgba(255, 255, 255, 0.08);
  border-color: rgba(255, 255, 255, 0.15);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
}

.stack-layout .window-card--stack-inactive:hover {
  /* Hover effect for inactive windows */
  transform: translateY(-4px) scale(1.02);
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 255, 255, 0.25);
}

/* Stack info overlay */
.stack-layout__info {
  position: absolute;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 8px 16px;
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 20px;
  font-size: 14px;
  color: rgba(0, 0, 0, 0.7);
  font-weight: 500;
}

.stack-layout__count {
  color: rgba(0, 0, 0, 0.8);
}

.stack-layout__overflow {
  color: rgba(156, 163, 175, 1);
  font-size: 12px;
}

/* Empty state */
.stack-layout--empty {
  min-height: 300px;
}

.stack-layout__empty-message {
  text-align: center;
  color: rgba(0, 0, 0, 0.6);
}

.stack-layout__empty-icon {
  font-size: 48px;
  margin-bottom: 16px;
  opacity: 0.5;
}

.stack-layout__empty-message p {
  font-size: 18px;
  margin: 0;
  font-weight: 500;
}

/* Enhanced responsive design for vertical-focused layout */
@media (max-width: 1024px) {
  .stack-layout__container {
    width: 450px;
    height: 700px;
  }
}

@media (max-width: 768px) {
  .stack-layout {
    padding: 20px 10px;
    min-height: 800px;
  }
  
  .stack-layout__container {
    width: 400px;
    height: 600px;
  }
  
  /* Reduce offsets for smaller screens */
  .stack-layout__window-wrapper--inactive {
    /* Mobile-specific positioning will be handled by inline styles */
  }
  
  .stack-layout__info {
    bottom: 10px;
    font-size: 12px;
    padding: 6px 12px;
  }
}

@media (max-width: 480px) {
  .stack-layout__container {
    width: 350px;
    height: 500px;
  }
  
  .stack-layout {
    min-height: 600px;
  }
}

/* High DPI displays */
@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
  .stack-layout__info {
    border-width: 0.5px;
  }
}

/* Dark mode support */
@media (prefers-color-scheme: dark) {
  .stack-layout__info {
    background: rgba(0, 0, 0, 0.3);
    border-color: rgba(255, 255, 255, 0.1);
    color: rgba(255, 255, 255, 0.8);
  }
  
  .stack-layout__count {
    color: rgba(255, 255, 255, 0.9);
  }
  
  .stack-layout__overflow {
    color: rgba(156, 163, 175, 0.8);
  }
  
  .stack-layout__empty-message {
    color: rgba(255, 255, 255, 0.7);
  }
  
  .stack-layout .window-card--stack-inactive {
    background: rgba(255, 255, 255, 0.05);
    border-color: rgba(255, 255, 255, 0.1);
  }
  
  .stack-layout .window-card--stack-inactive:hover {
    background: rgba(255, 255, 255, 0.08);
    border-color: rgba(255, 255, 255, 0.2);
  }
}

/* Focus accessibility */
.stack-layout__window-wrapper:focus-within {
  outline: 2px solid rgba(59, 130, 246, 0.6);
  outline-offset: 4px;
  border-radius: 20px;
}

/* Animation conflict prevention */
.stack-layout--animating .stack-layout__window-wrapper:hover {
  /* Disable hover effects during transitions to prevent conflicts */
  transform: none !important;
}

.stack-layout--animating .window-card--stack-inactive:hover {
  /* Disable card hover effects during stack transitions */
  transform: none !important;
  background: rgba(255, 255, 255, 0.08) !important;
}

/* History-based visual age effects with fallbacks */
.stack-layout__window-wrapper--aged-recent {
  /* Recently used windows get subtle enhancement */
  filter: saturate(1.1) brightness(1.02);
  -webkit-filter: saturate(1.1) brightness(1.02);
}

.stack-layout__window-wrapper--aged-moderate {
  /* Moderately aged windows get subtle desaturation */
  filter: saturate(0.9) brightness(0.95);
  -webkit-filter: saturate(0.9) brightness(0.95);
}

.stack-layout__window-wrapper--aged-old {
  /* Old windows get more pronounced aging effects */
  filter: saturate(0.7) brightness(0.9) grayscale(0.1);
  -webkit-filter: saturate(0.7) brightness(0.9) grayscale(0.1);
}

.stack-layout__window-wrapper--aged-ancient {
  /* Very old windows get maximum aging effects */
  filter: saturate(0.5) brightness(0.85) grayscale(0.2);
  -webkit-filter: saturate(0.5) brightness(0.85) grayscale(0.2);
}

/* Fallback for browsers without filter support */
@supports not (filter: saturate(1)) {
  .stack-layout__window-wrapper--aged-moderate {
    opacity: 0.92;
  }
  
  .stack-layout__window-wrapper--aged-old {
    opacity: 0.85;
  }
  
  .stack-layout__window-wrapper--aged-ancient {
    opacity: 0.75;
  }
}

/* History depth indicators */
.stack-layout .window-card--history-recent {
  /* Recent windows get slight warm tint */
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(59, 130, 246, 0.15);
}

.stack-layout .window-card--history-moderate {
  /* Moderate history windows remain neutral */
  background: rgba(255, 255, 255, 0.08);
  border-color: rgba(255, 255, 255, 0.15);
}

.stack-layout .window-card--history-old {
  /* Old windows get cooler, muted appearance */
  background: rgba(255, 255, 255, 0.06);
  border-color: rgba(255, 255, 255, 0.12);
}

.stack-layout .window-card--history-ancient {
  /* Ancient windows get very muted appearance */
  background: rgba(255, 255, 255, 0.04);
  border-color: rgba(255, 255, 255, 0.08);
}

/* Rapid change protection */
.stack-layout__window-wrapper {
  /* Prevent animation stacking with debounced timing */
  animation-fill-mode: both;
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
  .stack-layout__window-wrapper,
  .stack-layout__window-wrapper--transitioning,
  .stack-layout--animating .stack-layout__window-wrapper {
    transition: none !important;
    animation: none !important;
    will-change: auto !important;
  }
  
  .stack-layout .window-card--stack-inactive:hover {
    transform: none;
  }
}

/* Print styles */
@media print {
  .stack-layout {
    break-inside: avoid;
  }
  
  .stack-layout__window-wrapper {
    position: static !important;
    transform: none !important;
    opacity: 1 !important;
    margin-bottom: 20px;
  }
  
  .stack-layout__info {
    display: none;
  }
}