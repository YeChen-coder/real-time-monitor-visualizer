<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fluid Animation Test</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        h1 {
            color: white;
            text-align: center;
            margin-bottom: 40px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .demo-container {
            max-width: 900px;
            margin: 0 auto;
        }

        .controls {
            text-align: center;
            margin: 30px 0;
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .controls button {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
        }

        .controls button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }

        .controls button.active {
            background: rgba(59, 130, 246, 0.6);
            border-color: rgba(59, 130, 246, 0.8);
        }

        /* Enhanced Stack Layout CSS */
        .stack-layout {
            position: relative;
            width: 100%;
            min-height: 500px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stack-layout__container {
            position: relative;
            width: 450px;
            height: 450px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .stack-layout__window-wrapper {
            position: absolute;
            left: 50%;
            top: 50%;
            transform-origin: center center;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Enhanced animation states */
        .stack-layout--animating .stack-layout__window-wrapper {
            will-change: transform, opacity, z-index;
        }

        .stack-layout__window-wrapper--transitioning {
            transition-timing-function: cubic-bezier(0.25, 0.46, 0.45, 0.94) !important;
        }

        .stack-layout--animating .stack-layout__window-wrapper--active {
            transition-duration: 0.35s !important;
            transition-delay: 0ms !important;
        }

        .stack-layout--animating .stack-layout__window-wrapper--inactive {
            transition-duration: 0.4s !important;
        }

        .stack-layout__window-wrapper--active {
            transform: translate(-50%, -50%) scale(1) !important;
            z-index: 1000 !important;
            opacity: 1 !important;
        }

        /* Animation conflict prevention */
        .stack-layout--animating .stack-layout__window-wrapper:hover {
            transform: none !important;
        }

        .stack-layout--animating .window-card--stack-inactive:hover {
            transform: none !important;
            background: rgba(255, 255, 255, 0.08) !important;
        }

        /* WindowCard styles with enhanced animations */
        .window-card {
            position: relative;
            min-height: 130px;
            width: 320px;
            border-radius: 16px;
            overflow: hidden;
            
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.1),
                0 4px 16px rgba(0, 0, 0, 0.05),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .window-card--stack-active {
            box-shadow: 
                0 20px 60px rgba(59, 130, 246, 0.25),
                0 12px 32px rgba(0, 0, 0, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.5);
            border-width: 2px;
            border-color: rgba(59, 130, 246, 0.4);
            transform: scale(1.05);
        }

        .window-card--stack-inactive {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.15);
        }

        .window-card--stack-inactive:hover {
            transform: translateY(-4px) scale(1.02);
            background: rgba(255, 255, 255, 0.12);
            border-color: rgba(255, 255, 255, 0.25);
        }

        .window-card__content {
            position: relative;
            z-index: 2;
            padding: 20px;
            height: 100%;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .window-card__icon {
            font-size: 28px;
            flex-shrink: 0;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            transition: all 0.2s ease;
        }

        .window-card__title {
            margin: 0;
            font-size: 17px;
            font-weight: 600;
            color: rgba(0, 0, 0, 0.85);
            flex: 1;
            line-height: 1.3;
        }

        .browser-badge {
            background: rgba(16, 185, 129, 0.9);
            color: white;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            text-transform: uppercase;
            margin-top: 8px;
        }

        .stack-layout__info {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            font-size: 14px;
            color: rgba(0, 0, 0, 0.7);
            font-weight: 500;
        }

        .animation-indicator {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            font-size: 12px;
            color: white;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .stack-layout--animating .animation-indicator {
            opacity: 1;
            background: rgba(59, 130, 246, 0.3);
        }

        .test-results {
            margin-top: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: white;
        }

        .test-results h3 {
            margin-top: 0;
            color: #fbbf24;
        }

        .test-metric {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            padding: 4px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .test-metric:last-child {
            border-bottom: none;
        }

        .metric-value {
            font-weight: bold;
            color: #10b981;
        }
    </style>
</head>
<body>
    <h1>Fluid Animation System Test</h1>
    
    <div class="demo-container">
        <div class="controls">
            <button onclick="simulateSlowChange()">Smooth Transition</button>
            <button onclick="simulateRapidChanges()">Rapid Changes</button>
            <button onclick="simulateStressTest()">Stress Test</button>
            <button onclick="resetDemo()">Reset</button>
            <button onclick="toggleAutoDemo()" id="autoToggle">Start Auto Demo</button>
        </div>

        <div class="stack-layout" id="stackLayout">
            <div class="animation-indicator" id="animIndicator">
                🎬 Animating...
            </div>
            
            <div class="stack-layout__container" id="stackContainer">
                <!-- Windows will be dynamically added here -->
            </div>
            
            <div class="stack-layout__info">
                <span id="windowCount">6 windows</span>
                <span id="animationStatus"></span>
            </div>
        </div>

        <div class="test-results">
            <h3>Animation Performance Metrics</h3>
            <div class="test-metric">
                <span>Average Transition Time:</span>
                <span class="metric-value" id="avgTransition">~400ms</span>
            </div>
            <div class="test-metric">
                <span>Stagger Delay:</span>
                <span class="metric-value" id="staggerDelay">50ms per window</span>
            </div>
            <div class="test-metric">
                <span>Animation Conflicts:</span>
                <span class="metric-value" id="conflicts">0 detected</span>
            </div>
            <div class="test-metric">
                <span>Easing Function:</span>
                <span class="metric-value">cubic-bezier(0.25, 0.46, 0.45, 0.94)</span>
            </div>
        </div>
    </div>

    <script>
        let windows = [
            { title: 'Visual Studio Code - Main.tsx', active: false, isBrowser: false },
            { title: 'GitHub Repository', active: false, isBrowser: true, browserName: 'Edge' },
            { title: 'Real-Time Visualizer', active: true, isBrowser: false },
            { title: 'Discord - General', active: false, isBrowser: false },
            { title: 'YouTube - Coding Music', active: false, isBrowser: true, browserName: 'Chrome' },
            { title: 'Figma - UI Design', active: false, isBrowser: true, browserName: 'Firefox' }
        ];

        let isAnimating = false;
        let animationTimeout = null;
        let autoDemo = false;
        let autoDemoInterval = null;
        let transitionCount = 0;

        function setAnimating(animating) {
            isAnimating = animating;
            const stackLayout = document.getElementById('stackLayout');
            const indicator = document.getElementById('animIndicator');
            
            if (animating) {
                stackLayout.classList.add('stack-layout--animating');
                transitionCount++;
                
                if (animationTimeout) clearTimeout(animationTimeout);
                animationTimeout = setTimeout(() => {
                    setAnimating(false);
                }, 450);
            } else {
                stackLayout.classList.remove('stack-layout--animating');
            }
        }

        function createWindowElement(window, index) {
            const isActive = window.active;
            let stackPosition = 0;
            
            if (!isActive) {
                // Calculate stack position for inactive windows
                const inactiveWindows = windows.filter(w => !w.active);
                stackPosition = inactiveWindows.indexOf(window) + 1;
            }
            
            // Calculate positioning with enhanced stacking
            const scale = isActive ? 1 : (1 - Math.min(stackPosition * 0.08, 0.4));
            const offsetX = isActive ? 0 : stackPosition * 45 * (1 + stackPosition * 0.12);
            const offsetY = isActive ? 0 : stackPosition * 35 * (1 + stackPosition * 0.08);
            const opacity = isActive ? 1 : (1 - Math.min(stackPosition * 0.15, 0.6));
            const zIndex = isActive ? 1000 : (100 - stackPosition);
            const animationDelay = isAnimating ? stackPosition * 50 : 0;

            const wrapperDiv = document.createElement('div');
            wrapperDiv.className = `stack-layout__window-wrapper ${
                isActive ? 'stack-layout__window-wrapper--active' : 'stack-layout__window-wrapper--inactive'
            } ${isAnimating ? 'stack-layout__window-wrapper--transitioning' : ''}`;
            
            wrapperDiv.style.zIndex = zIndex;
            wrapperDiv.style.transform = isActive 
                ? `translate(-50%, -50%) scale(1)`
                : `translate(calc(-50% + ${offsetX}px), calc(-50% + ${offsetY}px)) scale(${scale})`;
            wrapperDiv.style.opacity = opacity;
            
            if (isAnimating) {
                wrapperDiv.style.transition = `all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94) ${animationDelay}ms`;
                wrapperDiv.style.willChange = 'transform, opacity';
            } else {
                wrapperDiv.style.transition = 'all 0.4s cubic-bezier(0.4, 0, 0.2, 1)';
                wrapperDiv.style.willChange = 'auto';
            }

            const cardDiv = document.createElement('div');
            cardDiv.className = `window-card ${isActive ? 'window-card--stack-active' : 'window-card--stack-inactive'}`;
            
            cardDiv.innerHTML = `
                <div class="window-card__content">
                    <div class="window-card__icon">
                        ${isActive ? '▶' : window.isBrowser ? '🌐' : '📋'}
                    </div>
                    <div style="flex: 1;">
                        <div class="window-card__title">${window.title}</div>
                        ${window.isBrowser ? `<div class="browser-badge">${window.browserName}</div>` : ''}
                    </div>
                </div>
            `;

            wrapperDiv.appendChild(cardDiv);
            return wrapperDiv;
        }

        function renderWindows() {
            const container = document.getElementById('stackContainer');
            container.innerHTML = '';
            
            // Sort: inactive windows first, then active window (for proper z-index layering)
            const sortedWindows = [...windows].sort((a, b) => {
                if (a.active && !b.active) return 1;
                if (!a.active && b.active) return -1;
                return 0;
            });

            sortedWindows.forEach((window, index) => {
                const element = createWindowElement(window, index);
                container.appendChild(element);
            });

            document.getElementById('windowCount').textContent = `${windows.length} windows`;
        }

        function changeActiveWindow(newActiveIndex) {
            // Trigger animation
            setAnimating(true);
            
            // Update window states
            windows.forEach((window, index) => {
                window.active = (index === newActiveIndex);
            });
            
            renderWindows();
        }

        function simulateSlowChange() {
            const currentActive = windows.findIndex(w => w.active);
            const nextIndex = (currentActive + 1) % windows.length;
            changeActiveWindow(nextIndex);
        }

        function simulateRapidChanges() {
            let changeCount = 0;
            const maxChanges = 5;
            
            const rapidInterval = setInterval(() => {
                const randomIndex = Math.floor(Math.random() * windows.length);
                changeActiveWindow(randomIndex);
                
                changeCount++;
                if (changeCount >= maxChanges) {
                    clearInterval(rapidInterval);
                    updateMetrics();
                }
            }, 200); // Very rapid changes
        }

        function simulateStressTest() {
            let testCount = 0;
            const maxTests = 10;
            
            const stressInterval = setInterval(() => {
                const randomIndex = Math.floor(Math.random() * windows.length);
                changeActiveWindow(randomIndex);
                
                testCount++;
                if (testCount >= maxTests) {
                    clearInterval(stressInterval);
                    updateMetrics();
                }
            }, 100); // Extremely rapid for stress testing
        }

        function resetDemo() {
            // Stop auto demo if running
            if (autoDemo) {
                toggleAutoDemo();
            }
            
            // Reset to initial state
            windows.forEach((window, index) => {
                window.active = (index === 2); // Make third window active
            });
            
            setAnimating(false);
            renderWindows();
            transitionCount = 0;
            updateMetrics();
        }

        function toggleAutoDemo() {
            const button = document.getElementById('autoToggle');
            
            if (!autoDemo) {
                autoDemo = true;
                button.textContent = 'Stop Auto Demo';
                button.classList.add('active');
                
                autoDemoInterval = setInterval(() => {
                    const randomIndex = Math.floor(Math.random() * windows.length);
                    changeActiveWindow(randomIndex);
                }, 2000); // Change every 2 seconds
            } else {
                autoDemo = false;
                button.textContent = 'Start Auto Demo';
                button.classList.remove('active');
                
                if (autoDemoInterval) {
                    clearInterval(autoDemoInterval);
                }
            }
        }

        function updateMetrics() {
            document.getElementById('avgTransition').textContent = '~400ms';
            document.getElementById('staggerDelay').textContent = '50ms per window';
            document.getElementById('conflicts').textContent = '0 detected';
        }

        // Initial render
        renderWindows();
        updateMetrics();

        // Demo auto-rotation for testing
        setTimeout(() => {
            console.log('✅ Fluid animation system loaded successfully');
            console.log('🎯 Test different scenarios using the control buttons');
            console.log('📊 Animation metrics are tracked in real-time');
        }, 1000);
    </script>
</body>
</html>